import{k as pe,c as Y,i as P,a as c,D as ae,C as pt,l as oe,r as we,q as Oe,p as V,K as ne,W as Je,n as ht,f as G,b as se,w as f,h as gt,z as be,y as ue,j as M,d as h,t as H,X as Ee,o as Fe,Y as mt,s as et,g as tt,A as Ne,F as ot,Z as vt,G as Se,$ as bt,H as nt,I as st,u as ee,N as ie,a0 as yt,M as te,e as kt}from"./index-BUa9bNcK.js";import{u as wt}from"./localTokenManager-BaV6E7aW.js";import{u as jt}from"./gameRoles-djadNtXw.js";import{_ as rt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{E as Ct}from"./EllipsisHorizontal-WgIGCDzJ.js";import{R as He}from"./Refresh-Dqzsnker.js";import{C as St}from"./CloudUpload-DkJuKY-D.js";import{S as Tt,C as it,a as _t,T as $t,b as Ot}from"./index-DaR6YUjQ.js";import{u as Et}from"./auth-CeqvcroZ.js";import{e as lt,f as xe,h as Lt,_ as ge,g as me,u as Vt,j as Pe,b as Ge,d as Mt,i as Le,k as Ke,s as Ft,a as xt,B as Pt}from"./index-DfbS2o1A.js";import{T as Wt,R as qt,p as Ut,q as At,u as Rt,r as zt}from"./index-CasQdCBa.js";const It={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Nt=c("rect",{x:"128",y:"128",width:"336",height:"336",rx:"57",ry:"57",fill:"none",stroke:"currentColor","stroke-linejoin":"round","stroke-width":"32"},null,-1),Ht=c("path",{d:"M383.5 128l.5-24a56.16 56.16 0 0 0-56-56H112a64.19 64.19 0 0 0-64 64v216a56.16 56.16 0 0 0 56 56h24",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),Gt=[Nt,Ht],Kt=pe({name:"CopyOutline",render:function(t,s){return P(),Y("svg",It,Gt)}});function Be(e){return typeof e=="object"&&e!=null&&e.nodeType===1}function Ze(e,t){return(!t||e!=="hidden")&&e!=="visible"&&e!=="clip"}function Te(e,t){if(e.clientHeight<e.scrollHeight||e.clientWidth<e.scrollWidth){var s=getComputedStyle(e,null);return Ze(s.overflowY,t)||Ze(s.overflowX,t)||function(o){var n=function(i){if(!i.ownerDocument||!i.ownerDocument.defaultView)return null;try{return i.ownerDocument.defaultView.frameElement}catch{return null}}(o);return!!n&&(n.clientHeight<o.scrollHeight||n.clientWidth<o.scrollWidth)}(e)}return!1}function ve(e,t,s,o,n,i,a,p){return i<e&&a>t||i>e&&a<t?0:i<=e&&p<=s||a>=t&&p>=s?i-e-o:a>t&&p<s||i<e&&p>s?a-t+n:0}var De=function(e,t){var s=window,o=t.scrollMode,n=t.block,i=t.inline,a=t.boundary,p=t.skipOverflowHiddenElements,O=typeof a=="function"?a:function(ft){return ft!==a};if(!Be(e))throw new TypeError("Invalid target");for(var E,R,B=document.scrollingElement||document.documentElement,S=[],$=e;Be($)&&O($);){if(($=(R=(E=$).parentElement)==null?E.getRootNode().host||null:R)===B){S.push($);break}$!=null&&$===document.body&&Te($)&&!Te(document.documentElement)||$!=null&&Te($,p)&&S.push($)}for(var U=s.visualViewport?s.visualViewport.width:innerWidth,W=s.visualViewport?s.visualViewport.height:innerHeight,F=window.scrollX||pageXOffset,g=window.scrollY||pageYOffset,r=e.getBoundingClientRect(),T=r.height,_=r.width,z=r.top,Z=r.right,I=r.bottom,d=r.left,l=n==="start"||n==="nearest"?z:n==="end"?I:z+T/2,m=i==="center"?d+_/2:i==="end"?Z:d,w=[],y=0;y<S.length;y++){var j=S[y],q=j.getBoundingClientRect(),D=q.height,x=q.width,N=q.top,v=q.right,C=q.bottom,u=q.left;if(o==="if-needed"&&z>=0&&d>=0&&I<=W&&Z<=U&&z>=N&&I<=C&&d>=u&&Z<=v)return w;var b=getComputedStyle(j),k=parseInt(b.borderLeftWidth,10),L=parseInt(b.borderTopWidth,10),Q=parseInt(b.borderRightWidth,10),K=parseInt(b.borderBottomWidth,10),A=0,J=0,ce="offsetWidth"in j?j.offsetWidth-j.clientWidth-k-Q:0,fe="offsetHeight"in j?j.offsetHeight-j.clientHeight-L-K:0,Ae="offsetWidth"in j?j.offsetWidth===0?0:x/j.offsetWidth:0,Re="offsetHeight"in j?j.offsetHeight===0?0:D/j.offsetHeight:0;if(B===j)A=n==="start"?l:n==="end"?l-W:n==="nearest"?ve(g,g+W,W,L,K,g+l,g+l+T,T):l-W/2,J=i==="start"?m:i==="center"?m-U/2:i==="end"?m-U:ve(F,F+U,U,k,Q,F+m,F+m+_,_),A=Math.max(0,A+g),J=Math.max(0,J+F);else{A=n==="start"?l-N-L:n==="end"?l-C+K+fe:n==="nearest"?ve(N,C,D,L,K+fe,l,l+T,T):l-(N+D/2)+fe/2,J=i==="start"?m-u-k:i==="center"?m-(u+x/2)+ce/2:i==="end"?m-v+Q+ce:ve(u,v,x,k,Q+ce,m,m+_,_);var ze=j.scrollLeft,Ie=j.scrollTop;l+=Ie-(A=Math.max(0,Math.min(Ie+A/Re,j.scrollHeight-D/Re+fe))),m+=ze-(J=Math.max(0,Math.min(ze+J/Ae,j.scrollWidth-x/Ae+ce)))}w.push({el:j,top:A,left:J})}return w};const Qe=(e,t)=>{if(!e||!t)return;t=t.replace(/\[(\w+)\]/g,".$1");const s=t.split(".");if(s.length===0)return;let o=e;for(let n=0;n<s.length;n++){if(!lt(o)&&!xe(o)||!s[n])return;if(n!==s.length-1)o=o[s[n]];else return o[s[n]]}},Ye=(e,t,s,{addPath:o}={})=>{if(!e||!t)return;t=t.replace(/\[(\w+)\]/g,".$1");const n=t.split(".");if(n.length===0)return;let i=e;for(let a=0;a<n.length;a++){if(!lt(i)&&!xe(i)||!n[a])return;a!==n.length-1?(o&&Lt(i[n[a]])&&(i[n[a]]={}),i=i[n[a]]):i[n[a]]=s}};function at(e){return e===Object(e)&&Object.keys(e).length!==0}function Bt(e,t){t===void 0&&(t="auto");var s="scrollBehavior"in document.body.style;e.forEach(function(o){var n=o.el,i=o.top,a=o.left;n.scroll&&s?n.scroll({top:i,left:a,behavior:t}):(n.scrollTop=i,n.scrollLeft=a)})}function Zt(e){return e===!1?{block:"end",inline:"nearest"}:at(e)?e:{block:"start",inline:"nearest"}}function Dt(e,t){var s=e.isConnected||e.ownerDocument.documentElement.contains(e);if(at(t)&&typeof t.behavior=="function")return t.behavior(s?De(e,t):[]);if(s){var o=Zt(t);return Bt(De(e,o),o.behavior)}}const Xe=["success","warning","error","validating"],Qt=e=>{let t="";for(const s of Object.keys(e)){const o=e[s];o&&(!t||Xe.indexOf(o)>Xe.indexOf(t))&&(t=e[s])}return t},Yt=e=>{const t=[];for(const s of Object.keys(e)){const o=e[s];o&&t.push(o)}return t},ut=(e,t)=>{const s=t.replace(/[[.]/g,"_").replace(/\]/g,"");return e?`${e}-${s}`:`${s}`},Xt=pe({name:"Form",props:{model:{type:Object,required:!0},layout:{type:String,default:"horizontal"},size:{type:String},labelColProps:{type:Object,default:()=>({span:5,offset:0})},wrapperColProps:{type:Object,default:()=>({span:19,offset:0})},labelColStyle:Object,wrapperColStyle:Object,labelAlign:{type:String,default:"right"},disabled:{type:Boolean,default:void 0},rules:{type:Object},autoLabelWidth:{type:Boolean,default:!1},id:{type:String},scrollToFirstError:{type:Boolean,default:!1}},emits:{submit:(e,t)=>!0,submitSuccess:(e,t)=>!0,submitFailed:(e,t)=>!0},setup(e,{emit:t}){const s=me("form"),o=we(),{id:n,model:i,layout:a,disabled:p,labelAlign:O,labelColProps:E,wrapperColProps:R,labelColStyle:B,wrapperColStyle:S,size:$,rules:U}=Oe(e),{mergedSize:W}=Vt($),F=V(()=>e.layout==="horizontal"&&e.autoLabelWidth),g=[],r=[],T=ne({}),_=V(()=>Math.max(...Object.values(T))),z=v=>{v&&v.field&&g.push(v)},Z=v=>{v&&v.field&&g.splice(g.indexOf(v),1)},I=v=>{g.forEach(C=>{v[C.field]&&C.setField(v[C.field])})},d=(v,C)=>{C&&T[C]!==v&&(T[C]=v)},l=v=>{v&&delete T[v]},m=v=>{const C=v?[].concat(v):[];g.forEach(u=>{(C.length===0||C.includes(u.field))&&u.resetField()})},w=v=>{const C=v?[].concat(v):[];g.forEach(u=>{(C.length===0||C.includes(u.field))&&u.clearValidate()})},y=(v,C)=>{const b=(o.value||document.body).querySelector(`#${ut(e.id,v)}`);b&&Dt(b,{behavior:"smooth",block:"nearest",scrollMode:"if-needed",...C})},j=v=>{const C=Mt(e.scrollToFirstError)?void 0:e.scrollToFirstError;y(v,C)},q=v=>{const C=[];return g.forEach(u=>{C.push(u.validate())}),Promise.all(C).then(u=>{const b={};let k=!1;return u.forEach(L=>{L&&(k=!0,b[L.field]=L)}),k&&e.scrollToFirstError&&j(Object.keys(b)[0]),Ge(v)&&v(k?b:void 0),k?b:void 0})},D=(v,C)=>{const u=[];for(const b of g)(xe(v)&&v.includes(b.field)||v===b.field)&&u.push(b.validate());return Promise.all(u).then(b=>{const k={};let L=!1;return b.forEach(Q=>{Q&&(L=!0,k[Q.field]=Q)}),L&&e.scrollToFirstError&&j(Object.keys(k)[0]),Ge(C)&&C(L?k:void 0),L?k:void 0})},x=v=>{const C=[];g.forEach(u=>{C.push(u.validate())}),Promise.all(C).then(u=>{const b={};let k=!1;u.forEach(L=>{L&&(k=!0,b[L.field]=L)}),k?(e.scrollToFirstError&&j(Object.keys(b)[0]),t("submitFailed",{values:i.value,errors:b},v)):t("submitSuccess",i.value,v),t("submit",{values:i.value,errors:k?b:void 0},v)})};return Je(Pe,ne({id:n,layout:a,disabled:p,labelAlign:O,labelColProps:E,wrapperColProps:R,labelColStyle:B,wrapperColStyle:S,model:i,size:W,rules:U,fields:g,touchedFields:r,addField:z,removeField:Z,validateField:D,setLabelWidth:d,removeLabelWidth:l,maxLabelWidth:_,autoLabelWidth:F})),{cls:V(()=>[s,`${s}-layout-${e.layout}`,`${s}-size-${W.value}`,{[`${s}-auto-label-width`]:e.autoLabelWidth}]),formRef:o,handleSubmit:x,innerValidate:q,innerValidateField:D,innerResetFields:m,innerClearValidate:w,innerSetFields:I,innerScrollToField:y}},methods:{validate(e){return this.innerValidate(e)},validateField(e,t){return this.innerValidateField(e,t)},resetFields(e){return this.innerResetFields(e)},clearValidate(e){return this.innerClearValidate(e)},setFields(e){return this.innerSetFields(e)},scrollToField(e){return this.innerScrollToField(e)}}}),Jt=["id"];function eo(e,t,s,o,n,i){return P(),Y("form",{id:e.id,ref:"formRef",class:oe(e.cls),onSubmit:t[0]||(t[0]=pt((...a)=>e.handleSubmit&&e.handleSubmit(...a),["prevent"]))},[ae(e.$slots,"default")],42,Jt)}var _e=ge(Xt,[["render",eo]]),he=Object.prototype.toString;function je(e){return he.call(e)==="[object Array]"}function re(e){return he.call(e)==="[object Object]"}function Ve(e){return he.call(e)==="[object String]"}function to(e){return he.call(e)==="[object Number]"&&e===e}function oo(e){return he.call(e)==="[object Boolean]"}function Me(e){return he.call(e)==="[object Function]"}function no(e){return re(e)&&Object.keys(e).length===0}function de(e){return e==null||e===""}function ct(e){return je(e)&&!e.length}var We=function(e,t){if(typeof e!="object"||typeof t!="object")return e===t;if(Me(e)&&Me(t))return e===t||e.toString()===t.toString();if(Object.keys(e).length!==Object.keys(t).length)return!1;for(var s in e){var o=We(e[s],t[s]);if(!o)return!1}return!0},qe=function(e,t){var s=Object.assign({},e);return Object.keys(t||{}).forEach(function(o){var n=s[o],i=t==null?void 0:t[o];s[o]=re(n)?Object.assign(Object.assign({},n),i):i||n}),s},so=function(e,t){for(var s=t.split("."),o=e,n=0;n<s.length;n++)if(o=o&&o[s[n]],o===void 0)return o;return o},le="#{field} is not a #{type} type",ro={required:"#{field} is required",type:{ip:le,email:le,url:le,string:le,number:le,array:le,object:le,boolean:le},number:{min:"`#{value}` is not greater than `#{min}`",max:"`#{value}` is not less than `#{max}`",equal:"`#{value}` is not equal to `#{equal}`",range:"`#{value}` is not in range `#{min} ~ #{max}`",positive:"`#{value}` is not a positive number",negative:"`#{value}` is not a negative number"},string:{maxLength:"#{field} cannot be longer than #{maxLength} characters",minLength:"#{field} must be at least #{minLength} characters",length:"#{field} must be exactly #{length} characters",match:"`#{value}` does not match pattern #{pattern}",uppercase:"`#{value}` must be all uppercase",lowercase:"`#{value}` must be all lowercased"},array:{length:"#{field} must be exactly #{length} in length",minLength:"#{field} cannot be less than #{minLength} in length",maxLength:"#{field} cannot be greater than #{maxLength} in length",includes:"#{field} is not includes #{includes}",deepEqual:"#{field} is not deep equal with #{deepEqual}",empty:"#{field} is not an empty array"},object:{deepEqual:"#{field} is not deep equal to expected value",hasKeys:"#{field} does not contain required fields",empty:"#{field} is not an empty object"},boolean:{true:"Expect true but got `#{value}`",false:"Expect false but got `#{value}`"}},X=function(t,s){var o=this;this.getValidateMsg=function(n,i){i===void 0&&(i={});var a=Object.assign(Object.assign({},i),{value:o.obj,field:o.field,type:o.type}),p=so(o.validateMessages,n);return Me(p)?p(a):Ve(p)?p.replace(/\#\{.+?\}/g,function(O){var E=O.slice(2,-1);if(E in a){if(re(a[E])||je(a[E]))try{return JSON.stringify(a[E])}catch{return a[E]}return String(a[E])}return O}):p},re(s)&&Ve(t)&&s.trim?this.obj=t.trim():re(s)&&s.ignoreEmptyString&&t===""?this.obj=void 0:this.obj=t,this.message=s.message,this.type=s.type,this.error=null,this.field=s.field||s.type,this.validateMessages=qe(ro,s.validateMessages)},Ce={not:{configurable:!0},isRequired:{configurable:!0},end:{configurable:!0}};Ce.not.get=function(){return this._not=!this._not,this};Ce.isRequired.get=function(){if(de(this.obj)||ct(this.obj)){var e=this.getValidateMsg("required");this.error={value:this.obj,type:this.type,requiredError:!0,message:this.message||(re(e)?e:(this._not?"[NOT MODE]:":"")+e)}}return this};Ce.end.get=function(){return this.error};X.prototype.addError=function(t){!this.error&&t&&(this.error={value:this.obj,type:this.type,message:this.message||(re(t)?t:(this._not?"[NOT MODE]:":"")+t)})};X.prototype.validate=function(t,s){var o=this._not?t:!t;return o&&this.addError(s),this};X.prototype.collect=function(t){t&&t(this.error)};Object.defineProperties(X.prototype,Ce);var io=function(e){function t(o,n){e.call(this,o,Object.assign(Object.assign({},n),{type:"string"})),this.validate(n&&n.strict?Ve(this.obj):!0,this.getValidateMsg("type.string"))}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var s={uppercase:{configurable:!0},lowercase:{configurable:!0}};return t.prototype.maxLength=function(n){return this.obj?this.validate(this.obj.length<=n,this.getValidateMsg("string.maxLength",{maxLength:n})):this},t.prototype.minLength=function(n){return this.obj?this.validate(this.obj.length>=n,this.getValidateMsg("string.minLength",{minLength:n})):this},t.prototype.length=function(n){return this.obj?this.validate(this.obj.length===n,this.getValidateMsg("string.length",{length:n})):this},t.prototype.match=function(n){var i=n instanceof RegExp;return i&&(n.lastIndex=0),this.validate(this.obj===void 0||i&&n.test(this.obj),this.getValidateMsg("string.match",{pattern:n}))},s.uppercase.get=function(){return this.obj?this.validate(this.obj.toUpperCase()===this.obj,this.getValidateMsg("string.uppercase")):this},s.lowercase.get=function(){return this.obj?this.validate(this.obj.toLowerCase()===this.obj,this.getValidateMsg("string.lowercase")):this},Object.defineProperties(t.prototype,s),t}(X),lo=function(e){function t(o,n){e.call(this,o,Object.assign(Object.assign({},n),{type:"number"})),this.validate(n&&n.strict?to(this.obj):!0,this.getValidateMsg("type.number"))}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var s={positive:{configurable:!0},negative:{configurable:!0}};return t.prototype.min=function(n){return de(this.obj)?this:this.validate(this.obj>=n,this.getValidateMsg("number.min",{min:n}))},t.prototype.max=function(n){return de(this.obj)?this:this.validate(this.obj<=n,this.getValidateMsg("number.max",{max:n}))},t.prototype.equal=function(n){return de(this.obj)?this:this.validate(this.obj===n,this.getValidateMsg("number.equal",{equal:n}))},t.prototype.range=function(n,i){return de(this.obj)?this:this.validate(this.obj>=n&&this.obj<=i,this.getValidateMsg("number.range",{min:n,max:i}))},s.positive.get=function(){return de(this.obj)?this:this.validate(this.obj>0,this.getValidateMsg("number.positive"))},s.negative.get=function(){return de(this.obj)?this:this.validate(this.obj<0,this.getValidateMsg("number.negative"))},Object.defineProperties(t.prototype,s),t}(X),ao=function(e){function t(o,n){e.call(this,o,Object.assign(Object.assign({},n),{type:"array"})),this.validate(n&&n.strict?je(this.obj):!0,this.getValidateMsg("type.array",{value:this.obj,type:this.type}))}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var s={empty:{configurable:!0}};return t.prototype.length=function(n){return this.obj?this.validate(this.obj.length===n,this.getValidateMsg("array.length",{value:this.obj,length:n})):this},t.prototype.minLength=function(n){return this.obj?this.validate(this.obj.length>=n,this.getValidateMsg("array.minLength",{value:this.obj,minLength:n})):this},t.prototype.maxLength=function(n){return this.obj?this.validate(this.obj.length<=n,this.getValidateMsg("array.maxLength",{value:this.obj,maxLength:n})):this},t.prototype.includes=function(n){var i=this;return this.obj?this.validate(n.every(function(a){return i.obj.indexOf(a)!==-1}),this.getValidateMsg("array.includes",{value:this.obj,includes:n})):this},t.prototype.deepEqual=function(n){return this.obj?this.validate(We(this.obj,n),this.getValidateMsg("array.deepEqual",{value:this.obj,deepEqual:n})):this},s.empty.get=function(){return this.validate(ct(this.obj),this.getValidateMsg("array.empty",{value:this.obj}))},Object.defineProperties(t.prototype,s),t}(X),uo=function(e){function t(o,n){e.call(this,o,Object.assign(Object.assign({},n),{type:"object"})),this.validate(n&&n.strict?re(this.obj):!0,this.getValidateMsg("type.object"))}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var s={empty:{configurable:!0}};return t.prototype.deepEqual=function(n){return this.obj?this.validate(We(this.obj,n),this.getValidateMsg("object.deepEqual",{deepEqual:n})):this},t.prototype.hasKeys=function(n){var i=this;return this.obj?this.validate(n.every(function(a){return i.obj[a]}),this.getValidateMsg("object.hasKeys",{keys:n})):this},s.empty.get=function(){return this.validate(no(this.obj),this.getValidateMsg("object.empty"))},Object.defineProperties(t.prototype,s),t}(X),co=function(e){function t(o,n){e.call(this,o,Object.assign(Object.assign({},n),{type:"boolean"})),this.validate(n&&n.strict?oo(this.obj):!0,this.getValidateMsg("type.boolean"))}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var s={true:{configurable:!0},false:{configurable:!0}};return s.true.get=function(){return this.validate(this.obj===!0,this.getValidateMsg("boolean.true"))},s.false.get=function(){return this.validate(this.obj===!1,this.getValidateMsg("boolean.false"))},Object.defineProperties(t.prototype,s),t}(X),fo=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,po=new RegExp("^(?!mailto:)(?:(?:http|https|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[0-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))|localhost)(?::\\d{2,5})?(?:(/|\\?|#)[^\\s]*)?$","i"),ho=/^(2(5[0-5]{1}|[0-4]\d{1})|[0-1]?\d{1,2})(\.(2(5[0-5]{1}|[0-4]\d{1})|[0-1]?\d{1,2})){3}$/,go=function(e){function t(o,n){e.call(this,o,Object.assign(Object.assign({},n),{type:"type"}))}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var s={email:{configurable:!0},url:{configurable:!0},ip:{configurable:!0}};return s.email.get=function(){return this.type="email",this.validate(this.obj===void 0||fo.test(this.obj),this.getValidateMsg("type.email"))},s.url.get=function(){return this.type="url",this.validate(this.obj===void 0||po.test(this.obj),this.getValidateMsg("type.url"))},s.ip.get=function(){return this.type="ip",this.validate(this.obj===void 0||ho.test(this.obj),this.getValidateMsg("type.ip"))},Object.defineProperties(t.prototype,s),t}(X),mo=function(e){function t(o,n){e.call(this,o,Object.assign(Object.assign({},n),{type:"custom"}))}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var s={validate:{configurable:!0}};return s.validate.get=function(){var o=this;return function(n,i){var a;if(n)return a=n(o.obj,o.addError.bind(o)),a&&a.then?(i&&a.then(function(){i&&i(o.error)},function(p){console.error(p)}),[a,o]):(i&&i(o.error),o.error)}},Object.defineProperties(t.prototype,s),t}(X),ke=function(e,t){return new dt(e,Object.assign({field:"value"},t))};ke.globalConfig={};ke.setGlobalConfig=function(e){ke.globalConfig=e||{}};var dt=function(t,s){var o=ke.globalConfig,n=Object.assign(Object.assign(Object.assign({},o),s),{validateMessages:qe(o.validateMessages,s.validateMessages)});this.string=new io(t,n),this.number=new lo(t,n),this.array=new ao(t,n),this.object=new uo(t,n),this.boolean=new co(t,n),this.type=new go(t,n),this.custom=new mo(t,n)},Ue=function(t,s){s===void 0&&(s={}),this.schema=t,this.options=s};Ue.prototype.messages=function(t){this.options=Object.assign(Object.assign({},this.options),{validateMessages:qe(this.options.validateMessages,t)})};Ue.prototype.validate=function(t,s){var o=this;if(!re(t))return;var n=[],i=null;function a(p,O){i||(i={}),(!i[p]||O.requiredError)&&(i[p]=O)}this.schema&&Object.keys(this.schema).forEach(function(p){if(je(o.schema[p]))for(var O=function(B){var S=o.schema[p][B],$=S.type,U=S.message;if(!$&&!S.validator)throw"You must specify a type to field "+p+"!";var W=Object.assign(Object.assign({},o.options),{message:U,field:p});"ignoreEmptyString"in S&&(W.ignoreEmptyString=S.ignoreEmptyString),"strict"in S&&(W.strict=S.strict);var F=new dt(t[p],W),g=F.type[$]||null;if(!g)if(S.validator){g=F.custom.validate(S.validator),Object.prototype.toString.call(g)==="[object Array]"&&g[0].then?n.push({function:g[0],_this:g[1],key:p}):g&&a(p,g);return}else g=F[$];if(Object.keys(S).forEach(function(r){S.required&&(g=g.isRequired),r!=="message"&&g[r]&&S[r]&&typeof g[r]=="object"&&(g=g[r]),g[r]&&S[r]!==void 0&&typeof g[r]=="function"&&(g=g[r](S[r]))}),g.collect(function(r){r&&a(p,r)}),i)return"break"},E=0;E<o.schema[p].length;E++){var R=O(E);if(R==="break")break}}),n.length>0?Promise.all(n.map(function(p){return p.function})).then(function(){n.forEach(function(p){p._this.error&&a(p.key,p._this.error)}),s&&s(i)}):s&&s(i)};const vo=pe({name:"IconQuestionCircle",props:{size:{type:[Number,String]},strokeWidth:{type:Number,default:4},strokeLinecap:{type:String,default:"butt",validator:e=>["butt","round","square"].includes(e)},strokeLinejoin:{type:String,default:"miter",validator:e=>["arcs","bevel","miter","miter-clip","round"].includes(e)},rotate:Number,spin:Boolean},emits:{click:e=>!0},setup(e,{emit:t}){const s=me("icon"),o=V(()=>[s,`${s}-question-circle`,{[`${s}-spin`]:e.spin}]),n=V(()=>{const a={};return e.size&&(a.fontSize=Le(e.size)?`${e.size}px`:e.size),e.rotate&&(a.transform=`rotate(${e.rotate}deg)`),a});return{cls:o,innerStyle:n,onClick:a=>{t("click",a)}}}}),bo=["stroke-width","stroke-linecap","stroke-linejoin"];function yo(e,t,s,o,n,i){return P(),Y("svg",{viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",class:oe(e.cls),style:ht(e.innerStyle),"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin,onClick:t[0]||(t[0]=(...a)=>e.onClick&&e.onClick(...a))},t[1]||(t[1]=[c("path",{d:"M42 24c0 9.941-8.059 18-18 18S6 33.941 6 24 14.059 6 24 6s18 8.059 18 18Z"},null,-1),c("path",{d:"M24.006 31v4.008m0-6.008L24 28c0-3 3-4 4.78-6.402C30.558 19.195 28.288 15 23.987 15c-4.014 0-5.382 2.548-5.388 4.514v.465"},null,-1)]),14,bo)}var $e=ge(vo,[["render",yo]]);const ko=Object.assign($e,{install:(e,t)=>{var s;const o=(s=t==null?void 0:t.iconPrefix)!=null?s:"";e.component(o+$e.name,$e)}}),wo=pe({name:"FormItemLabel",components:{ResizeObserver:qt,Tooltip:Wt,IconQuestionCircle:ko},props:{required:{type:Boolean,default:!1},showColon:{type:Boolean,default:!1},component:{type:String,default:"label"},asteriskPosition:{type:String,default:"start"},tooltip:{type:String},attrs:Object},setup(){const e=me("form-item-label"),t=Ee(Pe,void 0),s=mt(),o=we(),n=()=>{o.value&&Le(o.value.offsetWidth)&&(t==null||t.setLabelWidth(o.value.offsetWidth,s==null?void 0:s.uid))};return Fe(()=>{o.value&&Le(o.value.offsetWidth)&&(t==null||t.setLabelWidth(o.value.offsetWidth,s==null?void 0:s.uid))}),et(()=>{t==null||t.removeLabelWidth(s==null?void 0:s.uid)}),{prefixCls:e,labelRef:o,handleResize:n}}});function jo(e,t,s,o,n,i){const a=G("icon-question-circle"),p=G("Tooltip"),O=G("ResizeObserver");return P(),se(O,{onResize:e.handleResize},{default:f(()=>[(P(),se(gt(e.component),be({ref:"labelRef",class:e.prefixCls},e.attrs),{default:f(()=>[e.required&&e.asteriskPosition==="start"?(P(),Y("strong",{key:0,class:oe(`${e.prefixCls}-required-symbol`)},t[0]||(t[0]=[c("svg",{fill:"currentColor",viewBox:"0 0 1024 1024",width:"1em",height:"1em"},[c("path",{d:"M583.338667 17.066667c18.773333 0 34.133333 15.36 34.133333 34.133333v349.013333l313.344-101.888a34.133333 34.133333 0 0 1 43.008 22.016l42.154667 129.706667a34.133333 34.133333 0 0 1-21.845334 43.178667l-315.733333 102.4 208.896 287.744a34.133333 34.133333 0 0 1-7.509333 47.786666l-110.421334 80.213334a34.133333 34.133333 0 0 1-47.786666-7.509334L505.685333 706.218667 288.426667 1005.226667a34.133333 34.133333 0 0 1-47.786667 7.509333l-110.421333-80.213333a34.133333 34.133333 0 0 1-7.509334-47.786667l214.186667-295.253333L29.013333 489.813333a34.133333 34.133333 0 0 1-22.016-43.008l42.154667-129.877333a34.133333 34.133333 0 0 1 43.008-22.016l320.512 104.106667L412.672 51.2c0-18.773333 15.36-34.133333 34.133333-34.133333h136.533334z"})],-1)]),2)):ue("v-if",!0),ae(e.$slots,"default"),e.tooltip?(P(),se(p,{key:1,content:e.tooltip},{default:f(()=>[h(a,{class:oe(`${e.prefixCls}-tooltip`)},null,8,["class"])]),_:1},8,["content"])):ue("v-if",!0),e.required&&e.asteriskPosition==="end"?(P(),Y("strong",{key:2,class:oe(`${e.prefixCls}-required-symbol`)},t[1]||(t[1]=[c("svg",{fill:"currentColor",viewBox:"0 0 1024 1024",width:"1em",height:"1em"},[c("path",{d:"M583.338667 17.066667c18.773333 0 34.133333 15.36 34.133333 34.133333v349.013333l313.344-101.888a34.133333 34.133333 0 0 1 43.008 22.016l42.154667 129.706667a34.133333 34.133333 0 0 1-21.845334 43.178667l-315.733333 102.4 208.896 287.744a34.133333 34.133333 0 0 1-7.509333 47.786666l-110.421334 80.213334a34.133333 34.133333 0 0 1-47.786666-7.509334L505.685333 706.218667 288.426667 1005.226667a34.133333 34.133333 0 0 1-47.786667 7.509333l-110.421333-80.213333a34.133333 34.133333 0 0 1-7.509334-47.786667l214.186667-295.253333L29.013333 489.813333a34.133333 34.133333 0 0 1-22.016-43.008l42.154667-129.877333a34.133333 34.133333 0 0 1 43.008-22.016l320.512 104.106667L412.672 51.2c0-18.773333 15.36-34.133333 34.133333-34.133333h136.533334z"})],-1)]),2)):ue("v-if",!0),M(" "+H(e.showColon?":":""),1)]),_:3},16,["class"]))]),_:3},8,["onResize"])}var Co=ge(wo,[["render",jo]]);const So=pe({name:"FormItemMessage",props:{error:{type:Array,default:()=>[]},help:String},setup(){return{prefixCls:me("form-item-message")}}});function To(e,t,s,o,n,i){return e.error.length>0?(P(!0),Y(ot,{key:0},tt(e.error,a=>(P(),se(Ne,{key:a,name:"form-blink",appear:""},{default:f(()=>[c("div",{role:"alert",class:oe([e.prefixCls])},H(a),3)]),_:2},1024))),128)):e.help||e.$slots.help?(P(),se(Ne,{key:1,name:"form-blink",appear:""},{default:f(()=>[c("div",{class:oe([e.prefixCls,`${e.prefixCls}-help`])},[ae(e.$slots,"help",{},()=>[M(H(e.help),1)])],2)]),_:3})):ue("v-if",!0)}var _o=ge(So,[["render",To]]);const $o=pe({name:"FormItem",components:{ArcoRow:At,ArcoCol:Ut,FormItemLabel:Co,FormItemMessage:_o},props:{field:{type:String,default:""},label:String,tooltip:{type:String},showColon:{type:Boolean,default:!1},noStyle:{type:Boolean,default:!1},disabled:{type:Boolean,default:void 0},help:String,extra:String,required:{type:Boolean,default:!1},asteriskPosition:{type:String,default:"start"},rules:{type:[Object,Array]},validateStatus:{type:String},validateTrigger:{type:[String,Array],default:"change"},labelColProps:Object,wrapperColProps:Object,hideLabel:{type:Boolean,default:!1},hideAsterisk:{type:Boolean,default:!1},labelColStyle:Object,wrapperColStyle:Object,rowProps:Object,rowClass:[String,Array,Object],contentClass:[String,Array,Object],contentFlex:{type:Boolean,default:!0},mergeProps:{type:[Boolean,Function],default:!0},labelColFlex:{type:[Number,String]},feedback:{type:Boolean,default:!1},labelComponent:{type:String,default:"label"},labelAttrs:Object},setup(e){const t=me("form-item"),{field:s}=Oe(e),o=Ee(Pe,{}),{autoLabelWidth:n,layout:i}=Oe(o),{i18nMessage:a}=Rt(),p=V(()=>{var u;const b={...(u=e.labelColProps)!=null?u:o.labelColProps};return e.labelColFlex?b.flex=e.labelColFlex:o.autoLabelWidth&&(b.flex=`${o.maxLabelWidth}px`),b}),O=V(()=>{var u;const b={...(u=e.wrapperColProps)!=null?u:o.wrapperColProps};return s.value&&(b.id=ut(o.id,s.value)),(e.labelColFlex||o.autoLabelWidth)&&(b.flex="auto"),b}),E=V(()=>{var u;return(u=e.labelColStyle)!=null?u:o.labelColStyle}),R=V(()=>{var u;return(u=e.wrapperColStyle)!=null?u:o.wrapperColStyle}),B=Qe(o.model,e.field),S=ne({}),$=ne({}),U=V(()=>Qt(S)),W=V(()=>Yt($)),F=we(!1),g=V(()=>Qe(o.model,e.field)),r=V(()=>{var u;return!!((u=e.disabled)!=null?u:o!=null&&o.disabled)}),T=V(()=>{var u;return(u=e.validateStatus)!=null?u:U.value}),_=V(()=>T.value==="error"),z=V(()=>{var u,b,k;const L=[].concat((k=(b=e.rules)!=null?b:(u=o==null?void 0:o.rules)==null?void 0:u[e.field])!=null?k:[]),Q=L.some(K=>K.required);return e.required&&!Q?[{required:!0}].concat(L):L}),Z=V(()=>z.value.some(u=>u.required)),I=e.noStyle?Ee(Ke,void 0):void 0,d=(u,{status:b,message:k})=>{S[u]=b,$[u]=k,e.noStyle&&(I==null||I.updateValidateState(u,{status:b,message:k}))},l=V(()=>e.feedback&&T.value?T.value:void 0),m=()=>{var u;if(F.value)return Promise.resolve();const b=z.value;if(!s.value||b.length===0)return U.value&&j(),Promise.resolve();const k=s.value,L=g.value;d(k,{status:"",message:""});const Q=new Ue({[k]:b.map(({...K})=>(!K.type&&!K.validator&&(K.type="string"),K))},{ignoreEmptyString:!0,validateMessages:(u=a.value.form)==null?void 0:u.validateMessages});return new Promise(K=>{Q.validate({[k]:L},A=>{var J;const ce=!!(A!=null&&A[k]);d(k,{status:ce?"error":"",message:(J=A==null?void 0:A[k].message)!=null?J:""});const fe=ce?{label:e.label,field:s.value,value:A[k].value,type:A[k].type,isRequiredError:!!A[k].requiredError,message:A[k].message}:void 0;K(fe)})})},w=V(()=>[].concat(e.validateTrigger)),y=V(()=>w.value.reduce((u,b)=>{switch(b){case"change":return u.onChange=()=>{m()},u;case"input":return u.onInput=()=>{Se(()=>{m()})},u;case"focus":return u.onFocus=()=>{m()},u;case"blur":return u.onBlur=()=>{m()},u;default:return u}},{}));Je(Ke,ne({eventHandlers:y,size:o&&bt(o,"size"),disabled:r,error:_,feedback:l,updateValidateState:d}));const j=()=>{s.value&&d(s.value,{status:"",message:""})},x=ne({field:s,disabled:r,error:_,validate:m,clearValidate:j,resetField:()=>{j(),F.value=!0,o!=null&&o.model&&s.value&&Ye(o.model,s.value,B),Se(()=>{F.value=!1})},setField:u=>{var b,k;s.value&&(F.value=!0,"value"in u&&(o!=null&&o.model)&&s.value&&Ye(o.model,s.value,u.value),(u.status||u.message)&&d(s.value,{status:(b=u.status)!=null?b:"",message:(k=u.message)!=null?k:""}),Se(()=>{F.value=!1}))}});Fe(()=>{var u;x.field&&((u=o.addField)==null||u.call(o,x))}),et(()=>{var u;x.field&&((u=o.removeField)==null||u.call(o,x))});const N=V(()=>[t,`${t}-layout-${o.layout}`,{[`${t}-error`]:_.value,[`${t}-status-${T.value}`]:!!T.value},e.rowClass]),v=V(()=>[`${t}-label-col`,{[`${t}-label-col-left`]:o.labelAlign==="left",[`${t}-label-col-flex`]:o.autoLabelWidth||e.labelColFlex}]),C=V(()=>[`${t}-wrapper-col`,{[`${t}-wrapper-col-flex`]:!O.value}]);return{prefixCls:t,cls:N,isRequired:Z,isError:_,finalMessage:W,mergedLabelCol:p,mergedWrapperCol:O,labelColCls:v,autoLabelWidth:n,layout:i,mergedLabelStyle:E,wrapperColCls:C,mergedWrapperStyle:R}}});function Oo(e,t,s,o,n,i){var a;const p=G("FormItemLabel"),O=G("ArcoCol"),E=G("FormItemMessage"),R=G("ArcoRow");return e.noStyle?ae(e.$slots,"default",{key:0}):(P(),se(R,be({key:1,class:[e.cls,{[`${e.prefixCls}-has-help`]:!!((a=e.$slots.help)!=null?a:e.help)}],wrap:!(e.labelColFlex||e.autoLabelWidth),div:e.layout!=="horizontal"||e.hideLabel},e.rowProps),{default:f(()=>[e.hideLabel?ue("v-if",!0):(P(),se(O,be({key:0,class:e.labelColCls,style:e.mergedLabelStyle},e.mergedLabelCol),{default:f(()=>[h(p,{required:e.hideAsterisk?!1:e.isRequired,"show-colon":e.showColon,"asterisk-position":e.asteriskPosition,component:e.labelComponent,attrs:e.labelAttrs,tooltip:e.tooltip},{default:f(()=>[e.$slots.label||e.label?ae(e.$slots,"label",{key:0},()=>[M(H(e.label),1)]):ue("v-if",!0)]),_:3},8,["required","show-colon","asterisk-position","component","attrs","tooltip"])]),_:3},16,["class","style"])),h(O,be({class:e.wrapperColCls,style:e.mergedWrapperStyle},e.mergedWrapperCol),{default:f(()=>[c("div",{class:oe(`${e.prefixCls}-content-wrapper`)},[c("div",{class:oe([`${e.prefixCls}-content`,{[`${e.prefixCls}-content-flex`]:e.contentFlex},e.contentClass])},[ae(e.$slots,"default")],2)],2),e.isError||e.$slots.help||e.help?(P(),se(E,{key:0,error:e.finalMessage,help:e.help},vt({_:2},[e.$slots.help?{name:"help",fn:f(()=>[ae(e.$slots,"help")]),key:"0"}:void 0]),1032,["error","help"])):ue("v-if",!0),e.$slots.extra||e.extra?(P(),Y("div",{key:1,class:oe(`${e.prefixCls}-extra`)},[ae(e.$slots,"extra",{},()=>[M(H(e.extra),1)])],2)):ue("v-if",!0)]),_:3},16,["class","style"])]),_:3},16,["class","wrap","div"]))}var ye=ge($o,[["render",Oo]]);const Eo=Object.assign(_e,{Item:ye,install:(e,t)=>{Ft(e,t);const s=xt(t);e.component(s+_e.name,_e),e.component(s+ye.name,ye)}}),Lo={class:"token-section"},Vo={key:0,class:"token-item"},Mo={class:"token-info"},Fo={class:"token-value"},xo={key:1,class:"empty-token"},Po={class:"token-section"},Wo={class:"game-tokens-list"},qo={class:"token-header"},Uo={class:"role-info"},Ao={class:"role-name"},Ro={class:"role-server"},zo={class:"token-actions"},Io={class:"token-details"},No={class:"detail-item"},Ho={class:"detail-value"},Go={class:"detail-item"},Ko={class:"detail-value"},Bo={class:"detail-item"},Zo={class:"detail-value"},Do={class:"detail-item"},Qo={class:"detail-value"},Yo={class:"detail-item"},Xo={__name:"TokenManager",setup(e){const t=nt(),s=st(),o=wt(),n=jt(),i=d=>{if(!d)return"";const l=d.length;return l<=8?d:d.substring(0,8)+"***"+d.substring(l-8)},a=d=>new Date(d).toLocaleString("zh-CN"),p=d=>o.getWebSocketStatus(d),O=d=>{switch(d){case"connected":return"success";case"error":return"error";case"connecting":return"warning";default:return"default"}},E=d=>{switch(d){case"connected":return"已连接";case"error":return"连接错误";case"connecting":return"连接中";default:return"未连接"}},R=d=>{const l=[{label:"编辑",key:"edit",icon:()=>te(ie,null,{default:()=>te(Ot)})},{label:"复制Token",key:"copy",icon:()=>te(ie,null,{default:()=>te(Kt)})}];return d.importMethod==="url"&&d.sourceUrl?l.unshift({label:"从URL刷新",key:"refresh-url",icon:()=>te(ie,null,{default:()=>te(_t)})}):l.unshift({label:"刷新Token",key:"refresh",icon:()=>te(ie,null,{default:()=>te(He)})}),l.push({type:"divider"},{label:"删除",key:"delete",icon:()=>te(ie,null,{default:()=>te($t)})}),l},B=(d,l,m)=>{switch(d){case"edit":g();break;case"copy":r(m.token);break;case"refresh":W(l);break;case"refresh-url":T(l,m);break;case"delete":F(l);break}},S=()=>{o.initTokenManager(),t.success("Token数据已刷新")},$=()=>{s.warning({title:"清除用户Token",content:"确定要清除用户认证Token吗？这将会退出登录。",positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{o.clearUserToken(),t.success("用户Token已清除")}})},U=(d,l)=>{if(p(d)==="connected")o.closeWebSocketConnection(d),t.info("WebSocket连接已断开");else try{o.createWebSocketConnection(d,l.token,l.wsUrl),t.success("正在建立WebSocket连接...")}catch{t.error("建立WebSocket连接失败")}},W=d=>{const l=o.getGameToken(d);if(!l){t.error("找不到对应的Token数据");return}if(!l.sourceUrl){t.warning("该Token没有配置源地址，无法重新生成。请手动重新导入Token。");return}s.info({title:"重新获取Token",content:"确定要从源地址重新获取此角色的Token吗？",positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{try{const m=t.loading("正在重新获取Token...",{duration:0});let w;const y=l.sourceUrl;if(y.startsWith(window.location.origin)||y.startsWith("/")||y.startsWith("http://localhost")||y.startsWith("http://127.0.0.1"))w=await fetch(y);else try{w=await fetch(y,{method:"GET",headers:{Accept:"application/json"},mode:"cors"})}catch(D){throw new Error(`跨域请求被阻止。请确保目标服务器支持CORS。错误详情: ${D.message}`)}if(!w.ok)throw new Error(`请求失败: ${w.status} ${w.statusText}`);const q=await w.json();if(!q.token)throw new Error("返回数据中未找到token字段");o.updateGameToken(d,{token:q.token,server:q.server||l.server,regeneratedAt:new Date().toISOString(),lastRefreshed:new Date().toISOString()}),o.getWebSocketStatus(d)==="connected"&&(o.closeWebSocketConnection(d),setTimeout(()=>{o.createWebSocketConnection(d,q.token,l.wsUrl)},500)),m.destroy(),t.success("Token已成功重新获取")}catch(m){console.error("重新获取Token失败:",m),t.error(m.message||"Token重新获取失败")}}})},F=d=>{s.warning({title:"删除Token",content:"确定要删除此角色的游戏Token吗？这将断开相关的WebSocket连接。",positiveText:"确定删除",negativeText:"取消",onPositiveClick:()=>{o.removeGameToken(d),t.success("Token已删除")}})},g=(d,l)=>{t.info("编辑功能正在开发中")},r=async d=>{try{await navigator.clipboard.writeText(d),t.success("Token已复制到剪贴板")}catch{const m=document.createElement("textarea");m.value=d,document.body.appendChild(m),m.select(),document.execCommand("copy"),document.body.removeChild(m),t.success("Token已复制到剪贴板")}},T=async(d,l)=>{if(!l.sourceUrl){t.warning("该Token没有配置源URL");return}s.info({title:"从URL刷新Token",content:`确定要从源URL重新获取Token吗？
源地址：${l.sourceUrl}`,positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{try{const m=t.loading("正在从URL获取新Token...",{duration:0});let w;if(l.sourceUrl.startsWith(window.location.origin)||l.sourceUrl.startsWith("/")||l.sourceUrl.startsWith("http://localhost")||l.sourceUrl.startsWith("http://127.0.0.1"))w=await fetch(l.sourceUrl);else{const q=`/api/proxy?url=${encodeURIComponent(l.sourceUrl)}`;w=await fetch(q)}if(!w.ok)throw new Error(`HTTP ${w.status}: ${w.statusText}`);const j=await w.json();if(!j.token)throw new Error("返回数据中未找到token字段");o.updateGameToken(d,{token:j.token,lastUsed:new Date().toISOString()}),m.destroy(),t.success("Token刷新成功")}catch(m){console.error("URL刷新Token失败:",m),t.error("刷新失败: "+m.message)}}})},_=()=>{try{const d=o.exportTokens(),l=JSON.stringify(d,null,2),m=new Blob([l],{type:"application/json"}),w=document.createElement("a");w.href=URL.createObjectURL(m),w.download=`tokens_backup_${new Date().toISOString().split("T")[0]}.json`,w.click(),t.success("Token数据已导出")}catch(d){t.error("导出失败: "+d.message)}},z=({file:d})=>{const l=new FileReader;l.onload=m=>{try{const w=JSON.parse(m.target.result),y=o.importTokens(w);y.success?(t.success(y.message),n.fetchGameRoles()):t.error(y.message)}catch{t.error("导入失败：文件格式错误")}},l.readAsText(d.file)},Z=()=>{s.info({title:"清理过期Token",content:"确定要清理超过24小时未使用的Token吗？",positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{const d=o.cleanExpiredTokens();t.success(`已清理 ${d} 个过期Token`)}})},I=()=>{s.error({title:"清除所有Token",content:"确定要清除所有游戏Token吗？这将断开所有WebSocket连接。此操作不可恢复！",positiveText:"确定清除",negativeText:"取消",onPositiveClick:()=>{o.clearAllGameTokens(),t.success("所有游戏Token已清除")}})};return(d,l)=>{const m=G("n-button"),w=G("n-upload"),y=Tt,j=G("n-dropdown"),q=G("n-tag"),D=it;return P(),se(D,null,{extra:f(()=>[h(y,null,{default:f(()=>[h(m,{size:"small",onClick:S},{icon:f(()=>[h(ee(ie),null,{default:f(()=>[h(ee(He))]),_:1})]),default:f(()=>[l[0]||(l[0]=M(" 刷新 ",-1))]),_:1}),h(m,{size:"small",type:"warning",onClick:_},{icon:f(()=>[...l[1]||(l[1]=[c("i",{class:"i-mdi:download"},null,-1)])]),default:f(()=>[l[2]||(l[2]=M(" 导出 ",-1))]),_:1}),h(w,{"show-file-list":!1,accept:".json",onChange:z},{default:f(()=>[h(m,{size:"small",type:"info"},{icon:f(()=>[h(ee(ie),null,{default:f(()=>[h(ee(St))]),_:1})]),default:f(()=>[l[3]||(l[3]=M(" 导入 ",-1))]),_:1})]),_:1})]),_:1})]),default:f(()=>[c("div",Lo,[l[7]||(l[7]=c("h4",null,"用户认证Token",-1)),ee(o).userToken?(P(),Y("div",Vo,[c("div",Mo,[l[4]||(l[4]=c("span",{class:"token-label"},"Token:",-1)),c("span",Fo,H(i(ee(o).userToken)),1)]),h(m,{size:"tiny",type:"error",onClick:$},{default:f(()=>[...l[5]||(l[5]=[M(" 清除 ",-1)])]),_:1})])):(P(),Y("div",xo,[...l[6]||(l[6]=[c("span",null,"未设置用户Token",-1)])]))]),c("div",Po,[c("h4",null,"游戏角色Token ("+H(Object.keys(ee(o).gameTokens).length)+"个)",1),c("div",Wo,[(P(!0),Y(ot,null,tt(ee(yt),(x,N)=>(P(),Y("div",{key:N,class:"game-token-item"},[c("div",qo,[c("div",Uo,[c("span",Ao,H(x.roleName),1),c("span",Ro,H(x.server),1)]),c("div",zo,[h(m,{size:"tiny",type:p(N)==="connected"?"success":"default",onClick:v=>U(N,x)},{default:f(()=>[M(H(p(N)==="connected"?"断开WS":"连接WS"),1)]),_:2},1032,["type","onClick"]),h(j,{options:R(x),trigger:"click",onSelect:v=>B(v,N,x)},{default:f(()=>[h(m,{size:"tiny",type:"tertiary"},{icon:f(()=>[h(ee(ie),null,{default:f(()=>[h(ee(Ct))]),_:1})]),_:1})]),_:1},8,["options","onSelect"])])]),c("div",Io,[c("div",No,[l[8]||(l[8]=c("span",{class:"detail-label"},"Token:",-1)),c("span",Ho,H(i(x.token)),1)]),c("div",Go,[l[9]||(l[9]=c("span",{class:"detail-label"},"WebSocket URL:",-1)),c("span",Ko,H(x.wsUrl),1)]),c("div",Bo,[l[10]||(l[10]=c("span",{class:"detail-label"},"创建时间:",-1)),c("span",Zo,H(a(x.createdAt)),1)]),c("div",Do,[l[11]||(l[11]=c("span",{class:"detail-label"},"最后使用:",-1)),c("span",Qo,H(a(x.lastUsed)),1)]),c("div",Yo,[l[12]||(l[12]=c("span",{class:"detail-label"},"连接状态:",-1)),h(q,{size:"small",type:O(p(N))},{default:f(()=>[M(H(E(p(N))),1)]),_:2},1032,["type"])])])]))),128))])])]),actions:f(()=>[h(m,{type:"warning",onClick:Z},{default:f(()=>[...l[13]||(l[13]=[M(" 清理过期Token ",-1)])]),_:1}),h(m,{type:"error",onClick:I},{default:f(()=>[...l[14]||(l[14]=[M(" 清除所有Token ",-1)])]),_:1})]),_:1})}}},Jo=rt(Xo,[["__scopeId","data-v-8f2d39ac"]]),en={class:"profile-page"},tn={class:"container"},on={class:"security-items"},nn={class:"security-item"},sn={class:"security-item"},rn={class:"security-item"},ln={class:"security-item danger"},an={__name:"Profile",setup(e){kt();const t=nt(),s=st(),o=Et(),n=we(null),i=ne({username:"",email:"",nickname:"",phone:"",avatar:""}),a=ne({currentPassword:"",newPassword:"",confirmPassword:""}),p=ne({theme:"auto",language:"zh-CN",notifications:!0,autoExecute:!1}),O=[{label:"跟随系统",value:"auto"},{label:"浅色主题",value:"light"},{label:"深色主题",value:"dark"}],E=[{label:"简体中文",value:"zh-CN"},{label:"English",value:"en-US"}],R=async()=>{try{t.success("个人信息保存成功")}catch{t.error("保存失败，请稍后重试")}},B=async()=>{if(n.value)try{await n.value.validate(),t.success("密码修改成功"),Object.keys(a).forEach(g=>{a[g]=""})}catch{}},S=g=>{p.theme=g,localStorage.setItem("theme",g),g==="dark"?document.documentElement.setAttribute("data-theme","dark"):g==="light"?document.documentElement.removeAttribute("data-theme"):window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?document.documentElement.setAttribute("data-theme","dark"):document.documentElement.removeAttribute("data-theme")},$=()=>{t.info("两步验证设置功能开发中...")},U=()=>{t.info("登录历史查看功能开发中...")},W=()=>{t.info("数据导出功能开发中...")},F=()=>{s.warning({title:"删除账户",content:"此操作将永久删除您的账户和所有数据，且无法恢复。确定要继续吗？",positiveText:"确定删除",negativeText:"取消",onPositiveClick:()=>{t.error("账户删除功能暂未开放")}})};return Fe(()=>{o.userInfo&&Object.assign(i,o.userInfo);const g=localStorage.getItem("userPreferences");if(g)try{Object.assign(p,JSON.parse(g))}catch(r){console.error("解析用户偏好失败:",r)}}),(g,r)=>{const T=zt,_=ye,z=Eo,Z=Pt,I=it,d=G("n-select"),l=G("n-switch"),m=Jo,w=G("n-button");return P(),Y("div",en,[c("div",tn,[r[25]||(r[25]=c("div",{class:"page-header"},[c("h1",null,"个人资料"),c("p",null,"管理您的账户信息和偏好设置")],-1)),r[26]||(r[26]=c("h2",null,"基本信息",-1)),h(I,null,{actions:f(()=>[h(Z,{type:"primary",onClick:R},{default:f(()=>[...r[11]||(r[11]=[M(" 保存更改 ",-1)])]),_:1})]),default:f(()=>[h(z,{model:i,"label-placement":"left","label-width":"80px"},{default:f(()=>[h(_,{label:"用户名"},{default:f(()=>[h(T,{value:i.username,"onUpdate:value":r[0]||(r[0]=y=>i.username=y),readonly:""},null,8,["value"])]),_:1}),h(_,{label:"邮箱"},{default:f(()=>[h(T,{value:i.email,"onUpdate:value":r[1]||(r[1]=y=>i.email=y)},null,8,["value"])]),_:1}),h(_,{label:"昵称"},{default:f(()=>[h(T,{value:i.nickname,"onUpdate:value":r[2]||(r[2]=y=>i.nickname=y),placeholder:"请输入昵称"},null,8,["value"])]),_:1}),h(_,{label:"手机"},{default:f(()=>[h(T,{value:i.phone,"onUpdate:value":r[3]||(r[3]=y=>i.phone=y),placeholder:"请输入手机号"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1}),r[27]||(r[27]=c("h2",null,"密码修改",-1)),h(I,null,{actions:f(()=>[h(Z,{type:"primary",onClick:B},{default:f(()=>[...r[12]||(r[12]=[M(" 修改密码 ",-1)])]),_:1})]),default:f(()=>[h(z,{model:a,ref_key:"passwordFormRef",ref:n,"label-placement":"left","label-width":"100px"},{default:f(()=>[h(_,{label:"当前密码",prop:"currentPassword"},{default:f(()=>[h(T,{value:a.currentPassword,"onUpdate:value":r[4]||(r[4]=y=>a.currentPassword=y),type:"password",placeholder:"请输入当前密码"},null,8,["value"])]),_:1}),h(_,{label:"新密码",prop:"newPassword"},{default:f(()=>[h(T,{value:a.newPassword,"onUpdate:value":r[5]||(r[5]=y=>a.newPassword=y),type:"password",placeholder:"请输入新密码"},null,8,["value"])]),_:1}),h(_,{label:"确认新密码",prop:"confirmPassword"},{default:f(()=>[h(T,{value:a.confirmPassword,"onUpdate:value":r[6]||(r[6]=y=>a.confirmPassword=y),type:"password",placeholder:"请再次输入新密码"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1}),r[28]||(r[28]=c("h2",null,"系统偏好",-1)),h(I,null,{default:f(()=>[h(z,null,{default:f(()=>[h(_,{label:"主题设置"},{extra:f(()=>[...r[13]||(r[13]=[M(" 选择您喜欢的界面主题 ",-1)])]),default:f(()=>[h(d,{value:p.theme,"onUpdate:value":[r[7]||(r[7]=y=>p.theme=y),S],options:O},null,8,["value"])]),_:1}),h(_,{label:"语言设置"},{extra:f(()=>[...r[14]||(r[14]=[M(" 选择界面显示语言 ",-1)])]),default:f(()=>[h(d,{value:p.language,"onUpdate:value":r[8]||(r[8]=y=>p.language=y),options:E},null,8,["value"])]),_:1}),h(_,{label:"通知设置"},{extra:f(()=>[...r[15]||(r[15]=[M(" 接收任务完成通知 ",-1)])]),default:f(()=>[h(l,{value:p.notifications,"onUpdate:value":r[9]||(r[9]=y=>p.notifications=y)},null,8,["value"])]),_:1}),h(_,{label:"自动执行"},{extra:f(()=>[...r[16]||(r[16]=[M(" 默认开启任务自动执行 ",-1)])]),default:f(()=>[h(l,{value:p.autoExecute,"onUpdate:value":r[10]||(r[10]=y=>p.autoExecute=y)},null,8,["value"])]),_:1})]),_:1})]),_:1}),r[29]||(r[29]=c("h2",null,"Token管理",-1)),h(m),r[30]||(r[30]=c("h2",null,"账户安全",-1)),h(I,null,{default:f(()=>[c("div",on,[c("div",nn,[r[18]||(r[18]=c("div",{class:"security-info"},[c("h3",null,"两步验证"),c("p",null,"为您的账户添加额外的安全保护")],-1)),h(w,{onClick:$},{default:f(()=>[...r[17]||(r[17]=[M(" 设置 ",-1)])]),_:1})]),c("div",sn,[r[20]||(r[20]=c("div",{class:"security-info"},[c("h3",null,"登录历史"),c("p",null,"查看最近的登录记录")],-1)),h(w,{onClick:U},{default:f(()=>[...r[19]||(r[19]=[M(" 查看 ",-1)])]),_:1})]),c("div",rn,[r[22]||(r[22]=c("div",{class:"security-info"},[c("h3",null,"数据导出"),c("p",null,"导出您的所有数据")],-1)),h(w,{onClick:W},{default:f(()=>[...r[21]||(r[21]=[M(" 导出 ",-1)])]),_:1})]),c("div",ln,[r[24]||(r[24]=c("div",{class:"security-info"},[c("h3",null,"删除账户"),c("p",null,"永久删除您的账户和所有数据")],-1)),h(w,{type:"error",onClick:F},{default:f(()=>[...r[23]||(r[23]=[M(" 删除 ",-1)])]),_:1})])])]),_:1})])])}}},kn=rt(an,[["__scopeId","data-v-fba61635"]]);export{kn as default};
