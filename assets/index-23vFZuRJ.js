import{T as nt,H as Le}from"./ThemeToggle-DXE3mNbN.js";import{k as ae,c as D,i as v,a as f,n as de,l as F,p as j,q as We,d as s,r as b,o as Re,s as lt,v as Me,f as x,b as L,w as r,T as st,x as we,y as $,z as Te,A as De,B as he,C as pe,D as Ce,j as _,t as W,E as Pe,G as at,H as rt,I as it,J as ut,K as ct,u as y,F as dt,g as ft,L as Ie,e as mt,N as P,M as H}from"./index-BUa9bNcK.js";import{_ as pt}from"./xiaoyugan-BojFO6Mw.js";import vt from"./manual-C9WFLHZD.js";import kt from"./url-C-hSd_Vy.js";import{K as gt,E as yt,B as bt,T as wt}from"./bin-BSCvwSvN.js";import{_ as Tt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as Ve,g as Ae,i as Ue,s as He,a as Ge,B as Ke,b as se,c as Ne,d as je}from"./index-DfbS2o1A.js";import{g as ht,i as Ct,o as fe,a as xe,I as St,b as $t,c as _t,d as Bt,e as Ot,C as Mt,u as Ut,f as xt,h as Et,j as At,k as Lt,M as Dt,l as Pt,m as Se,n as It}from"./index-CasQdCBa.js";import{C as Nt,S as jt,a as zt,T as Ft,b as Wt}from"./index-DaR6YUjQ.js";import{A as ze}from"./Add-BaDzFYPb.js";import{R as Fe}from"./Refresh-Dqzsnker.js";import{E as Rt}from"./EllipsisHorizontal-WgIGCDzJ.js";import{C as Vt}from"./Copy-q0PHnrJV.js";import"./CloudUpload-DkJuKY-D.js";import"./index-ngrFHoWO.js";const Ht={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Gt=f("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-miterlimit":"10","stroke-width":"48",d:"M88 152h336"},null,-1),Kt=f("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-miterlimit":"10","stroke-width":"48",d:"M88 256h336"},null,-1),Yt=f("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-miterlimit":"10","stroke-width":"48",d:"M88 360h336"},null,-1),qt=[Gt,Kt,Yt],Xt=ae({name:"Menu",render:function(n,i){return v(),D("svg",Ht,qt)}}),Zt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Jt=f("path",{d:"M394 480a16 16 0 0 1-9.39-3L256 383.76L127.39 477a16 16 0 0 1-24.55-18.08L153 310.35L23 221.2a16 16 0 0 1 9-29.2h160.38l48.4-148.95a16 16 0 0 1 30.44 0l48.4 149H480a16 16 0 0 1 9.05 29.2L359 310.35l50.13 148.53A16 16 0 0 1 394 480z",fill:"currentColor"},null,-1),Qt=[Jt],eo=ae({name:"Star",render:function(n,i){return v(),D("svg",Zt,Qt)}}),to=ae({name:"IconInfoCircleFill",props:{size:{type:[Number,String]},strokeWidth:{type:Number,default:4},strokeLinecap:{type:String,default:"butt",validator:e=>["butt","round","square"].includes(e)},strokeLinejoin:{type:String,default:"miter",validator:e=>["arcs","bevel","miter","miter-clip","round"].includes(e)},rotate:Number,spin:Boolean},emits:{click:e=>!0},setup(e,{emit:n}){const i=Ae("icon"),a=j(()=>[i,`${i}-info-circle-fill`,{[`${i}-spin`]:e.spin}]),g=j(()=>{const c={};return e.size&&(c.fontSize=Ue(e.size)?`${e.size}px`:e.size),e.rotate&&(c.transform=`rotate(${e.rotate}deg)`),c});return{cls:a,innerStyle:g,onClick:c=>{n("click",c)}}}}),oo=["stroke-width","stroke-linecap","stroke-linejoin"];function no(e,n,i,a,g,l){return v(),D("svg",{viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",class:F(e.cls),style:de(e.innerStyle),"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin,onClick:n[0]||(n[0]=(...c)=>e.onClick&&e.onClick(...c))},n[1]||(n[1]=[f("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M24 44c11.046 0 20-8.954 20-20S35.046 4 24 4 4 12.954 4 24s8.954 20 20 20Zm2-30a1 1 0 0 0-1-1h-2a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1v-2Zm0 17h1a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1h-6a1 1 0 0 1-1-1v-2a1 1 0 0 1 1-1h1v-8a1 1 0 0 1-1-1v-2a1 1 0 0 1 1-1h3a1 1 0 0 1 1 1v11Z",fill:"currentColor",stroke:"none"},null,-1)]),14,oo)}var $e=Ve(to,[["render",no]]);const lo=Object.assign($e,{install:(e,n)=>{var i;const a=(i=n==null?void 0:n.iconPrefix)!=null?i:"";e.component(a+$e.name,$e)}}),so=["red","orangered","orange","gold","lime","green","cyan","arcoblue","purple","pinkpurple","magenta","gray"],ao=["normal","processing","success","warning","danger"];var _e=ae({name:"Badge",props:{text:{type:String},dot:{type:Boolean},dotStyle:{type:Object},maxCount:{type:Number,default:99},offset:{type:Array,default:()=>[]},color:{type:String},status:{type:String,validator:e=>ao.includes(e)},count:{type:Number}},setup(e,{slots:n}){const{status:i,color:a,dotStyle:g,offset:l,text:c,dot:M,maxCount:T,count:m}=We(e),p=Ae("badge"),h=ro(p,i==null?void 0:i.value,n==null?void 0:n.default),E=j(()=>{const u={...(g==null?void 0:g.value)||{}},[C,B]=(l==null?void 0:l.value)||[];C&&(u.marginRight=`${-C}px`),B&&(u.marginTop=`${B}px`);const O=!(a!=null&&a.value)||so.includes(a==null?void 0:a.value)?{}:{backgroundColor:a.value};return{mergedStyle:{...O,...u},computedDotStyle:u,computedColorStyle:O}}),A=()=>{const u=c==null?void 0:c.value,C=a==null?void 0:a.value,B=i==null?void 0:i.value,O=M==null?void 0:M.value,U=Number(m==null?void 0:m.value),G=(m==null?void 0:m.value)!=null,{computedDotStyle:I,mergedStyle:z}=E.value;return n.content?s("span",{class:`${p}-custom-dot`,style:I},[n.content()]):u&&!C&&!B?s("span",{class:`${p}-text`,style:I},[u]):B||C&&!G?s("span",{class:`${p}-status-wrapper`},[s("span",{class:[`${p}-status-dot`,{[`${p}-status-${B}`]:B,[`${p}-color-${C}`]:C}],style:z},null),u&&s("span",{class:`${p}-status-text`},[u])]):(O||C)&&U>0?s("span",{class:[`${p}-dot`,{[`${p}-color-${C}`]:C}],style:z},null):U===0?null:s("span",{class:`${p}-number`,style:z},[s("span",null,[T.value&&U>T.value?`${T.value}+`:U])])};return()=>s("span",{class:h.value},[n.default&&n.default(),A()])}});const ro=(e,n,i)=>j(()=>[e,{[`${e}-status`]:n,[`${e}-no-children`]:!i}]),io=Object.assign(_e,{install:(e,n)=>{He(e,n);const i=Ge(n);e.component(i+_e.name,_e)}}),uo=e=>{const n=b(!1),i={overflow:"",width:"",boxSizing:""};return{setOverflowHidden:()=>{if(e.value){const l=e.value;if(!n.value&&l.style.overflow!=="hidden"){const c=ht(l);(c>0||Ct(l))&&(i.overflow=l.style.overflow,i.width=l.style.width,i.boxSizing=l.style.boxSizing,l.style.overflow="hidden",l.style.width=`${l.offsetWidth-c}px`,l.style.boxSizing="border-box",n.value=!0)}}},resetOverflow:()=>{if(e.value&&n.value){const l=e.value;l.style.overflow=i.overflow,l.style.width=i.width,l.style.boxSizing=i.boxSizing,n.value=!1}}}},co=({modalRef:e,wrapperRef:n,draggable:i,alignCenter:a})=>{const g=b(!1),l=b([0,0]),c=b([0,0]),M=b(),T=b([0,0]),m=b([0,0]),p=()=>{var u,C,B;if(n.value&&e.value){const{top:O,left:U}=n.value.getBoundingClientRect(),{clientWidth:G,clientHeight:I}=n.value,{top:z,left:Z,width:K,height:Y}=e.value.getBoundingClientRect(),R=a.value?0:(u=e.value)==null?void 0:u.offsetTop,N=Z-U,J=z-O-R;(N!==((C=c.value)==null?void 0:C[0])||J!==((B=c.value)==null?void 0:B[1]))&&(c.value=[N,J]);const q=G>K?G-K:0,Q=I>Y?I-Y-R:0;(q!==m.value[0]||Q!==m.value[1])&&(m.value=[q,Q]),R&&(T.value=[0,0-R])}},h=u=>{i.value&&(u.preventDefault(),g.value=!0,p(),l.value=[u.x,u.y],fe(window,"mousemove",E),fe(window,"mouseup",A),fe(window,"contextmenu",A))},E=u=>{if(g.value){const C=u.x-l.value[0],B=u.y-l.value[1];let O=c.value[0]+C,U=c.value[1]+B;O<T.value[0]&&(O=T.value[0]),O>m.value[0]&&(O=m.value[0]),U<T.value[1]&&(U=T.value[1]),U>m.value[1]&&(U=m.value[1]),M.value=[O,U]}},A=()=>{g.value=!1,xe(window,"mousemove",E),xe(window,"mouseup",A)};return{position:M,handleMoveDown:h}};var fo=ae({name:"Modal",components:{ClientOnly:Mt,ArcoButton:Ke,IconHover:Ot,IconClose:Bt,IconInfoCircleFill:lo,IconCheckCircleFill:_t,IconExclamationCircleFill:$t,IconCloseCircleFill:St},inheritAttrs:!1,props:{visible:{type:Boolean,default:void 0},defaultVisible:{type:Boolean,default:!1},width:{type:[Number,String]},top:{type:[Number,String]},mask:{type:Boolean,default:!0},title:{type:String},titleAlign:{type:String,default:"center"},alignCenter:{type:Boolean,default:!0},unmountOnClose:Boolean,maskClosable:{type:Boolean,default:!0},hideCancel:{type:Boolean,default:!1},simple:{type:Boolean,default:e=>e.notice},closable:{type:Boolean,default:!0},okText:String,cancelText:String,okLoading:{type:Boolean,default:!1},okButtonProps:{type:Object},cancelButtonProps:{type:Object},footer:{type:Boolean,default:!0},renderToBody:{type:Boolean,default:!0},popupContainer:{type:[String,Object],default:"body"},maskStyle:{type:Object},modalClass:{type:[String,Array]},modalStyle:{type:Object},onBeforeOk:{type:Function},onBeforeCancel:{type:Function},escToClose:{type:Boolean,default:!0},draggable:{type:Boolean,default:!1},fullscreen:{type:Boolean,default:!1},maskAnimationName:{type:String,default:e=>e.fullscreen?"fade-in-standard":"fade-modal"},modalAnimationName:{type:String,default:e=>e.fullscreen?"zoom-in":"zoom-modal"},bodyClass:{type:[String,Array]},bodyStyle:{type:[String,Object,Array]},messageType:{type:String},hideTitle:{type:Boolean,default:!1}},emits:{"update:visible":e=>!0,ok:e=>!0,cancel:e=>!0,open:()=>!0,close:()=>!0,beforeOpen:()=>!0,beforeClose:()=>!0},setup(e,{emit:n}){const{fullscreen:i,popupContainer:a,alignCenter:g}=We(e),l=Ae("modal"),{t:c}=Ut(),M=b(),T=b(),m=b(e.defaultVisible),p=j(()=>{var t;return(t=e.visible)!=null?t:m.value}),h=b(!1),E=j(()=>e.okLoading||h.value),A=j(()=>e.draggable&&!e.fullscreen),{teleportContainer:u,containerRef:C}=xt({popupContainer:a,visible:p}),B=b(p.value),O=j(()=>e.okText||c("modal.okText")),U=j(()=>e.cancelText||c("modal.cancelText")),{zIndex:G,isLastDialog:I}=Et("dialog",{visible:p});let z=!1;const Z=t=>{e.escToClose&&t.key===gt.ESC&&I()&&te(t)},K=()=>{e.escToClose&&!z&&(z=!0,fe(document.documentElement,"keydown",Z))},Y=()=>{z=!1,xe(document.documentElement,"keydown",Z)};let R=0;const{position:N,handleMoveDown:J}=co({wrapperRef:M,modalRef:T,draggable:A,alignCenter:g}),q=()=>{R++,h.value&&(h.value=!1),m.value=!1,n("update:visible",!1)},Q=async t=>{const k=R,w=await new Promise(async V=>{var X;if(se(e.onBeforeOk)){let S=e.onBeforeOk((ee=!0)=>V(ee));if((Ne(S)||!je(S))&&(h.value=!0),Ne(S))try{S=(X=await S)!=null?X:!0}catch(ee){throw S=!1,ee}je(S)&&V(S)}else V(!0)});k===R&&(w?(n("ok",t),q()):h.value&&(h.value=!1))},te=t=>{var k;let w=!0;se(e.onBeforeCancel)&&(w=(k=e.onBeforeCancel())!=null?k:!1),w&&(n("cancel",t),q())},oe=b(!1),ve=t=>{t.target===M.value&&(oe.value=!0)},ke=t=>{e.mask&&e.maskClosable&&oe.value&&te(t)},ge=()=>{p.value&&(!Lt(M.value,document.activeElement)&&document.activeElement instanceof HTMLElement&&document.activeElement.blur(),n("open"))},ye=()=>{p.value||(A.value&&(N.value=void 0),B.value=!1,re(),n("close"))},{setOverflowHidden:ne,resetOverflow:re}=uo(C);Re(()=>{C.value=At(e.popupContainer),p.value&&(ne(),e.escToClose&&K())}),lt(()=>{re(),Y()}),Me(p,t=>{m.value!==t&&(m.value=t),t?(n("beforeOpen"),B.value=!0,oe.value=!1,ne(),K()):(n("beforeClose"),Y())}),Me(i,()=>{N.value&&(N.value=void 0)});const be=j(()=>[`${l}-wrapper`,{[`${l}-wrapper-align-center`]:e.alignCenter&&!e.fullscreen,[`${l}-wrapper-moved`]:!!N.value}]),ie=j(()=>[`${l}`,e.modalClass,{[`${l}-simple`]:e.simple,[`${l}-draggable`]:A.value,[`${l}-fullscreen`]:e.fullscreen}]),o=j(()=>{var t;const k={...(t=e.modalStyle)!=null?t:{}};return e.width&&!e.fullscreen&&(k.width=Ue(e.width)?`${e.width}px`:e.width),!e.alignCenter&&e.top&&(k.top=Ue(e.top)?`${e.top}px`:e.top),N.value&&(k.transform=`translate(${N.value[0]}px, ${N.value[1]}px)`),k});return{prefixCls:l,mounted:B,computedVisible:p,containerRef:C,wrapperRef:M,mergedModalStyle:o,okDisplayText:O,cancelDisplayText:U,zIndex:G,handleOk:Q,handleCancel:te,handleMaskClick:ke,handleMaskMouseDown:ve,handleOpen:ge,handleClose:ye,mergedOkLoading:E,modalRef:T,wrapperCls:be,modalCls:ie,teleportContainer:u,handleMoveDown:J}}});function mo(e,n,i,a,g,l){const c=x("icon-info-circle-fill"),M=x("icon-check-circle-fill"),T=x("icon-exclamation-circle-fill"),m=x("icon-close-circle-fill"),p=x("icon-close"),h=x("icon-hover"),E=x("arco-button"),A=x("client-only");return v(),L(A,null,{default:r(()=>[(v(),L(st,{to:e.teleportContainer,disabled:!e.renderToBody},[!e.unmountOnClose||e.computedVisible||e.mounted?we((v(),D("div",Te({key:0,class:`${e.prefixCls}-container`,style:{zIndex:e.zIndex}},e.$attrs),[s(De,{name:e.maskAnimationName,appear:""},{default:r(()=>[e.mask?we((v(),D("div",{key:0,ref:"maskRef",class:F(`${e.prefixCls}-mask`),style:de(e.maskStyle)},null,6)),[[he,e.computedVisible]]):$("v-if",!0)]),_:1},8,["name"]),f("div",{ref:"wrapperRef",class:F(e.wrapperCls),onClick:n[2]||(n[2]=pe((...u)=>e.handleMaskClick&&e.handleMaskClick(...u),["self"])),onMousedown:n[3]||(n[3]=pe((...u)=>e.handleMaskMouseDown&&e.handleMaskMouseDown(...u),["self"]))},[s(De,{name:e.modalAnimationName,appear:"",onAfterEnter:e.handleOpen,onAfterLeave:e.handleClose,persisted:""},{default:r(()=>[we(f("div",{ref:"modalRef",class:F(e.modalCls),style:de(e.mergedModalStyle)},[!e.hideTitle&&(e.$slots.title||e.title||e.closable)?(v(),D("div",{key:0,class:F(`${e.prefixCls}-header`),onMousedown:n[1]||(n[1]=(...u)=>e.handleMoveDown&&e.handleMoveDown(...u))},[e.$slots.title||e.title?(v(),D("div",{key:0,class:F([`${e.prefixCls}-title`,`${e.prefixCls}-title-align-${e.titleAlign}`])},[e.messageType?(v(),D("div",{key:0,class:F(`${e.prefixCls}-title-icon`)},[e.messageType==="info"?(v(),L(c,{key:0})):$("v-if",!0),e.messageType==="success"?(v(),L(M,{key:1})):$("v-if",!0),e.messageType==="warning"?(v(),L(T,{key:2})):$("v-if",!0),e.messageType==="error"?(v(),L(m,{key:3})):$("v-if",!0)],2)):$("v-if",!0),Ce(e.$slots,"title",{},()=>[_(W(e.title),1)])],2)):$("v-if",!0),!e.simple&&e.closable?(v(),D("div",{key:1,tabindex:"-1",role:"button","aria-label":"Close",class:F(`${e.prefixCls}-close-btn`),onClick:n[0]||(n[0]=(...u)=>e.handleCancel&&e.handleCancel(...u))},[s(h,null,{default:r(()=>[s(p)]),_:1})],2)):$("v-if",!0)],34)):$("v-if",!0),f("div",{class:F([`${e.prefixCls}-body`,e.bodyClass]),style:de(e.bodyStyle)},[Ce(e.$slots,"default")],6),e.footer?(v(),D("div",{key:1,class:F(`${e.prefixCls}-footer`)},[Ce(e.$slots,"footer",{},()=>[e.hideCancel?$("v-if",!0):(v(),L(E,Te({key:0},e.cancelButtonProps,{onClick:e.handleCancel}),{default:r(()=>[_(W(e.cancelDisplayText),1)]),_:1},16,["onClick"])),s(E,Te({type:"primary"},e.okButtonProps,{loading:e.mergedOkLoading,onClick:e.handleOk}),{default:r(()=>[_(W(e.okDisplayText),1)]),_:1},16,["loading","onClick"])])],2)):$("v-if",!0)],6),[[he,e.computedVisible]])]),_:3},8,["name","onAfterEnter","onAfterLeave"])],34)],16)),[[he,e.computedVisible||e.mounted]]):$("v-if",!0)],8,["to","disabled"]))]),_:3})}var me=Ve(fo,[["render",mo]]);const Be=(e,n)=>{let i=Pt("modal");const a=()=>{m.component&&(m.component.props.visible=!1),se(e.onOk)&&e.onOk()},g=()=>{m.component&&(m.component.props.visible=!1),se(e.onCancel)&&e.onCancel()},l=async()=>{await at(),i&&(Pe(null,i),document.body.removeChild(i)),i=null,se(e.onClose)&&e.onClose()},c=()=>{m.component&&(m.component.props.visible=!1)},M=p=>{m.component&&Object.entries(p).forEach(([h,E])=>{m.component.props[h]=E})},m=s(me,{...{visible:!0,renderToBody:!1,unmountOnClose:!0,onOk:a,onCancel:g,onClose:l},...It(e,["content","title","footer","visible","unmountOnClose","onOk","onCancel","onClose"]),footer:typeof e.footer=="boolean"?e.footer:void 0},{default:Se(e.content),title:Se(e.title),footer:typeof e.footer!="boolean"?Se(e.footer):void 0});return(n??Ee._context)&&(m.appContext=n??Ee._context),Pe(m,i),document.body.appendChild(i),{close:c,update:M}},Oe={open:Be,confirm:(e,n)=>{const i={simple:!0,messageType:"warning",...e};return Be(i,n)},...Dt.reduce((e,n)=>(e[n]=(i,a)=>{const g={simple:!0,hideCancel:!0,messageType:n,...i};return Be(g,a)},e),{})},Ee=Object.assign(me,{...Oe,install:(e,n)=>{He(e,n);const i=Ge(n);e.component(i+me.name,me);const a={};for(const g of Object.keys(Oe))a[g]=(l,c=e._context)=>Oe[g](l,c);e.config.globalProperties.$modal=a},_context:null}),po={class:"token-import-page"},vo={class:"container"},ko={class:"page-header"},go={class:"header-content"},yo={class:"header-top"},bo={class:"card-header"},wo={class:"card-body"},To={key:0,class:"tokens-section"},ho={class:"section-header"},Co={class:"header-actions"},So={class:"tokens-grid"},$o={class:"token-display"},_o={class:"token-value"},Bo={class:"token-timestamps"},Oo={class:"timestamp-item"},Mo={class:"timestamp-value"},Uo={class:"timestamp-item"},xo={class:"timestamp-value"},Eo={class:"storage-info"},Ao={class:"storage-item"},Lo={key:0,class:"storage-upgrade"},Do={class:"modal-actions"},Po={__name:"index",props:{token:String,name:String,server:String,wsUrl:String,api:String,auto:Boolean},setup(e){const n=e,i=mt(),a=rt(),g=it(),l=ut(),c=b(!1),M=b(!1),T=b(!1);b(null),b(null);const m=b(null),p=b(null),h=b("manual"),E=b(new Set),A=b(new Set),u=ct({name:"",token:"",server:"",wsUrl:""}),C={name:[{required:!0,message:"请输入Token名称",trigger:"blur"}],token:[{required:!0,message:"请输入Token字符串",trigger:"blur"}]},B=[{label:"导出所有Token",key:"export"},{label:"导入Token文件",key:"import"},{label:"清理过期Token",key:"clean"},{label:"断开所有连接",key:"disconnect"},{label:"清除所有Token",key:"clear"}],O=async o=>{E.value.add(o.id);try{if(o.sourceUrl){let t;if(o.sourceUrl.startsWith(window.location.origin)||o.sourceUrl.startsWith("/")||o.sourceUrl.startsWith("http://localhost")||o.sourceUrl.startsWith("http://127.0.0.1"))t=await fetch(o.sourceUrl);else try{t=await fetch(o.sourceUrl,{method:"GET",headers:{Accept:"application/json"},mode:"cors"})}catch(V){throw new Error(`跨域请求被阻止。请确保目标服务器支持CORS。错误详情: ${V.message}`)}if(!t.ok)throw new Error(`请求失败: ${t.status} ${t.statusText}`);const w=await t.json();if(!w.token)throw new Error("返回数据中未找到token字段");l.updateToken(o.id,{token:w.token,server:w.server||o.server,lastRefreshed:Date.now()}),a.success("Token刷新成功")}else{g.info({title:"重新获取Token",content:`Token "${o.name}" 是手动导入的，没有配置自动刷新地址。

请选择以下操作：
1. 重新手动导入新的Token
2. 尝试重新连接现有Token`,positiveText:"重新导入",negativeText:"重新连接",onPositiveClick:()=>{c.value=!0,h.value="manual",importForm.name=o.name,importForm.server=o.server,importForm.wsUrl=o.wsUrl},onNegativeClick:()=>{l.getWebSocketStatus(o.id)==="connected"&&l.closeWebSocketConnection(o.id),setTimeout(()=>{l.createWebSocketConnection(o.id,o.token,o.wsUrl),a.info("正在尝试重新连接...")},500)}});return}l.getWebSocketStatus(o.id)==="connected"&&(l.closeWebSocketConnection(o.id),setTimeout(()=>{l.createWebSocketConnection(o.id,o.token,o.wsUrl)},500))}catch(t){console.error("刷新Token失败:",t),a.error(t.message||"Token刷新失败")}finally{E.value.delete(o.id)}},U=o=>{g.warning({title:"升级为长期有效",content:`确认要将Token "${o.name}" 升级为长期有效吗？升级后该Token将不会因24小时未使用而被自动清理。`,positiveText:"确认升级",negativeText:"取消",onPositiveClick:()=>{l.upgradeTokenToPermanent(o.id)?a.success(`Token "${o.name}" 已升级为长期有效！`):a.error("升级失败，该Token可能已经是长期有效状态")}})},G=(o,t=!1)=>{const k=Ie.value===o.id,w=I(o.id);if(k&&w==="connected"&&!t){a.info(`${o.name} 已选中且已连接`);return}if(k&&w==="connecting"&&!t){a.info(`${o.name} 正在连接中...`);return}l.selectToken(o.id,t)?t?a.success(`强制重连：${o.name}`):k?a.success(`重新连接：${o.name}`):a.success(`已选择：${o.name}`):a.error(`选择Token失败：${o.name}`)},I=o=>l.getWebSocketStatus(o),z=o=>{const t=I(o);return{connected:"已连接",connecting:"连接中...",disconnected:"已断开",error:"连接错误",disconnecting:"断开中..."}[t]||"未连接"},Z=o=>{const t=I(o);return{connected:"success",connecting:"processing",disconnected:"normal",error:"danger",disconnecting:"warning"}[t]||"normal"},K=o=>{const t=[{label:"编辑",key:"edit",icon:()=>H(P,null,{default:()=>H(Wt)})},{label:"复制Token",key:"copy",icon:()=>H(P,null,{default:()=>H(Vt)})}];return o.importMethod==="url"&&o.sourceUrl?t.push({label:"从URL刷新",key:"refresh-url",icon:()=>H(P,null,{default:()=>H(zt)})}):t.push({label:"重新获取",key:"refresh",icon:()=>H(P,null,{default:()=>H(Fe)})}),t.push({type:"divider"},{label:"删除",key:"delete",icon:()=>H(P,null,{default:()=>H(Ft)}),props:{style:{color:"#e74c3c"}}}),t},Y=async(o,t)=>{switch(o){case"edit":R(t);break;case"copy":J(t);break;case"refresh":O(t);break;case"refresh-url":O(t);break;case"delete":q(t);break}},R=o=>{p.value=o,Object.assign(u,{name:o.name,token:o.token,server:o.server||"",wsUrl:o.wsUrl||""}),T.value=!0},N=async()=>{if(!(!m.value||!p.value))try{await m.value.validate(),l.updateToken(p.value.id,{name:u.name,token:u.token,server:u.server,wsUrl:u.wsUrl}),a.success("Token信息已更新"),T.value=!1,p.value=null}catch{}},J=async o=>{try{await navigator.clipboard.writeText(o.token),a.success("Token已复制到剪贴板")}catch{a.error("复制失败")}},q=o=>{g.warning({title:"删除Token",content:`确定要删除Token "${o.name}" 吗？此操作无法恢复。`,positiveText:"确定删除",negativeText:"取消",onPositiveClick:()=>{l.removeToken(o.id),a.success("Token已删除")}})},Q=o=>{switch(o){case"export":te();break;case"import":oe();break;case"clean":ve();break;case"disconnect":ke();break;case"clear":ge();break}},te=()=>{try{const o=l.exportTokens(),t=JSON.stringify(o,null,2),k=new Blob([t],{type:"application/json"}),w=document.createElement("a");w.href=URL.createObjectURL(k),w.download=`tokens_backup_${new Date().toISOString().split("T")[0]}.json`,w.click(),a.success("Token数据已导出")}catch{a.error("导出失败")}},oe=()=>{const o=document.createElement("input");o.type="file",o.accept=".json",o.onchange=t=>{const k=t.target.files[0];if(k){const w=new FileReader;w.onload=V=>{try{const X=JSON.parse(V.target.result),S=l.importTokens(X);S.success?a.success(S.message):a.error(S.message)}catch{a.error("文件格式错误")}},w.readAsText(k)}},o.click()},ve=()=>{const o=l.cleanExpiredTokens();a.success(`已清理 ${o} 个过期Token`)},ke=()=>{l.gameTokens.forEach(o=>{l.closeWebSocketConnection(o.id)}),a.success("所有连接已断开")},ge=()=>{g.error({title:"清除所有Token",content:"确定要清除所有Token吗？此操作无法恢复！",positiveText:"确定清除",negativeText:"取消",onPositiveClick:()=>{l.clearAllTokens(),a.success("所有Token已清除")}})},ye=o=>{if(!o)return"";const t=o.length;return t<=8?o:o.substring(0,4)+"***"+o.substring(t-4)},ne=o=>new Date(o).toLocaleString("zh-CN"),re=()=>{i.push("/admin/dashboard")},be=async o=>{A.value.add(o.id);try{if(l.selectToken(o.id),I(o.id)==="connected"){a.success(`${o.name} 已连接，进入任务管理`),i.push("/admin/dashboard");return}}finally{A.value.delete(o.id)}},ie=async()=>{if(n.token||n.api)try{M.value=!0;let o=null;if(n.api){a.info("正在从API获取token...");const t=await fetch(n.api,{method:"GET",headers:{Accept:"application/json"},mode:"cors"});if(!t.ok)throw new Error(`API请求失败: ${t.status} ${t.statusText}`);const k=await t.json();if(!k.token)throw new Error("API返回数据中未找到token字段");o=l.importBase64Token(n.name||k.name||"通过API导入的Token",k.token,{server:n.server||k.server,wsUrl:n.wsUrl,sourceUrl:n.api,importMethod:"url"})}else n.token&&(a.info("正在导入token..."),o=l.importBase64Token(n.name||"通过URL导入的Token",n.token,{server:n.server,wsUrl:n.wsUrl,importMethod:"url"}));if(o&&o.success)a.success(`Token "${o.tokenName}" 导入成功！`),n.auto&&o.token?(l.selectToken(o.token.id),a.success("正在跳转到控制台..."),setTimeout(()=>{i.push("/admin/dashboard")},1500)):i.replace("/tokens");else throw new Error((o==null?void 0:o.message)||"Token导入失败")}catch(o){console.error("URL参数处理失败:",o),a.error(`导入失败: ${o.message}`),i.replace("/tokens")}finally{M.value=!1}};return Me(()=>[n.token,n.api],ie,{immediate:!1}),Re(async()=>{l.initTokenStore(),await ie(),!l.hasTokens&&!n.token&&!n.api&&(c.value=!0)}),(o,t)=>{const k=nt,w=x("n-radio-button"),V=x("n-radio-group"),X=Ee,S=x("n-button"),ee=x("n-dropdown"),Ye=wt,qe=io,Xe=jt,Ze=Ke,Je=x("n-tag"),Qe=Nt,et=yt,ue=x("n-input"),ce=x("n-form-item"),tt=x("n-form"),ot=x("n-modal");return v(),D("div",po,[f("div",vo,[f("div",ko,[f("div",go,[f("div",yo,[t[15]||(t[15]=f("img",{src:pt,alt:"XYZW",class:"brand-logo"},null,-1)),s(k)]),t[16]||(t[16]=f("h1",null,"游戏Token管理",-1))])]),s(X,{visible:c.value,"onUpdate:visible":t[7]||(t[7]=d=>c.value=d),width:"40rem",footer:!1,"default-visible":!y(l).hasTokens},{title:r(()=>[f("h2",null,[s(y(P),null,{default:r(()=>[s(y(ze))]),_:1}),t[17]||(t[17]=_(" 添加游戏Token ",-1))])]),default:r(()=>[f("div",bo,[s(V,{value:h.value,"onUpdate:value":t[0]||(t[0]=d=>h.value=d),class:"import-method-tabs",size:"small"},{default:r(()=>[s(w,{value:"manual"},{default:r(()=>[...t[18]||(t[18]=[_(" 手动输入 ",-1)])]),_:1}),s(w,{value:"url"},{default:r(()=>[...t[19]||(t[19]=[_(" URL获取 ",-1)])]),_:1}),s(w,{value:"bin"},{default:r(()=>[...t[20]||(t[20]=[_(" BIN获取 ",-1)])]),_:1})]),_:1},8,["value"])]),f("div",wo,[h.value==="manual"?(v(),L(vt,{key:0,onCancel:t[1]||(t[1]=()=>c.value=!1),onOk:t[2]||(t[2]=()=>c.value=!1)})):$("",!0),h.value==="url"?(v(),L(kt,{key:1,onCancel:t[3]||(t[3]=()=>c.value=!1),onOk:t[4]||(t[4]=()=>c.value=!1)})):$("",!0),h.value==="bin"?(v(),L(bt,{key:2,onCancel:t[5]||(t[5]=()=>c.value=!1),onOk:t[6]||(t[6]=()=>c.value=!1)})):$("",!0)])]),_:1},8,["visible","default-visible"]),y(l).hasTokens?(v(),D("div",To,[f("div",ho,[f("h2",null,"我的Token列表 ("+W(y(l).gameTokens.length)+"个)",1),f("div",Co,[y(l).selectedToken?(v(),L(S,{key:0,type:"success",onClick:re},{icon:r(()=>[s(y(P),null,{default:r(()=>[s(y(Le))]),_:1})]),default:r(()=>[t[21]||(t[21]=_(" 返回控制台 ",-1))]),_:1})):$("",!0),c.value?$("",!0):(v(),L(S,{key:1,type:"primary",onClick:t[8]||(t[8]=d=>c.value=!0)},{icon:r(()=>[s(y(P),null,{default:r(()=>[s(y(ze))]),_:1})]),default:r(()=>[t[22]||(t[22]=_(" 添加Token ",-1))]),_:1})),s(ee,{options:B,onSelect:Q},{default:r(()=>[s(S,null,{icon:r(()=>[s(y(P),null,{default:r(()=>[s(y(Xt))]),_:1})]),default:r(()=>[t[23]||(t[23]=_(" 批量操作 ",-1))]),_:1})]),_:1})])]),f("div",So,[(v(!0),D(dt,null,ft(y(l).gameTokens,d=>(v(),L(Qe,{key:d.id,class:F({"token-card":!0,active:y(Ie)===d.id}),onClick:le=>G(d)},{title:r(()=>[s(Xe,{class:"token-name"},{default:r(()=>[_(W(d.name)+" ",1),d.server?(v(),L(Ye,{key:0,color:"red"},{default:r(()=>[_(W(d.server),1)]),_:2},1024)):$("",!0),s(qe,{status:Z(d.id),text:z(d.id)},null,8,["status","text"])]),_:2},1024)]),extra:r(()=>[s(ee,{options:K(d),onSelect:le=>Y(le,d)},{default:r(()=>[s(S,{text:""},{icon:r(()=>[s(y(P),null,{default:r(()=>[s(y(Rt))]),_:1})]),_:1})]),_:1},8,["options","onSelect"])]),default:r(()=>[f("div",$o,[t[24]||(t[24]=f("span",{class:"token-label"},"Token:",-1)),f("code",_o,W(ye(d.token)),1)]),s(Ze,{loading:E.value.has(d.id),onClick:pe(le=>O(d),["stop"])},{icon:r(()=>[s(y(P),null,{default:r(()=>[s(y(Fe))]),_:1})]),default:r(()=>[_(" "+W(d.sourceUrl?"刷新":"重新获取"),1)]),_:2},1032,["loading","onClick"]),f("div",Bo,[f("div",Oo,[t[25]||(t[25]=f("span",{class:"timestamp-label"},"创建：",-1)),f("span",Mo,W(ne(d.createdAt)),1)]),f("div",Uo,[t[26]||(t[26]=f("span",{class:"timestamp-label"},"使用：",-1)),f("span",xo,W(ne(d.lastUsed)),1)])]),f("div",Eo,[f("div",Ao,[t[27]||(t[27]=f("span",{class:"storage-label"},"存储类型：",-1)),s(Je,{size:"small",type:d.importMethod==="url"?"success":"warning"},{default:r(()=>[_(W(d.importMethod==="url"?"长期有效":"临时存储"),1)]),_:2},1032,["type"])]),d.importMethod!=="url"?(v(),D("div",Lo,[s(S,{size:"tiny",type:"success",ghost:"",onClick:pe(le=>U(d),["stop"])},{icon:r(()=>[s(y(P),null,{default:r(()=>[s(y(eo))]),_:1})]),default:r(()=>[t[28]||(t[28]=_(" 升级为长期有效 ",-1))]),_:1},8,["onClick"])])):$("",!0)])]),actions:r(()=>[s(S,{type:"primary",size:"large",block:"",loading:A.value.has(d.id),onClick:le=>be(d)},{icon:r(()=>[s(y(P),null,{default:r(()=>[s(y(Le))]),_:1})]),default:r(()=>[t[29]||(t[29]=_(" 开始任务管理 ",-1))]),_:1},8,["loading","onClick"])]),_:2},1032,["class","onClick"]))),128))])])):$("",!0),!y(l).hasTokens&&!c.value?(v(),L(et,{key:1},{image:r(()=>[...t[30]||(t[30]=[f("i",{class:"mdi:bed-empty"},null,-1)])]),default:r(()=>[t[31]||(t[31]=_(" 还没有导入任何Token ",-1))]),_:1})):$("",!0)]),s(ot,{show:T.value,"onUpdate:show":t[14]||(t[14]=d=>T.value=d),preset:"card",title:"编辑Token",style:{width:"500px"}},{footer:r(()=>[f("div",Do,[s(S,{onClick:t[13]||(t[13]=d=>T.value=!1)},{default:r(()=>[...t[32]||(t[32]=[_(" 取消 ",-1)])]),_:1}),s(S,{type:"primary",onClick:N},{default:r(()=>[...t[33]||(t[33]=[_(" 保存 ",-1)])]),_:1})])]),default:r(()=>[s(tt,{ref_key:"editFormRef",ref:m,model:u,rules:C,"label-placement":"left","label-width":"80px"},{default:r(()=>[s(ce,{label:"名称",path:"name"},{default:r(()=>[s(ue,{value:u.name,"onUpdate:value":t[9]||(t[9]=d=>u.name=d)},null,8,["value"])]),_:1}),s(ce,{label:"Token字符串",path:"token"},{default:r(()=>[s(ue,{value:u.token,"onUpdate:value":t[10]||(t[10]=d=>u.token=d),type:"textarea",rows:3,placeholder:"粘贴Token字符串...",clearable:""},null,8,["value"])]),_:1}),s(ce,{label:"服务器"},{default:r(()=>[s(ue,{value:u.server,"onUpdate:value":t[11]||(t[11]=d=>u.server=d)},null,8,["value"])]),_:1}),s(ce,{label:"WebSocket地址"},{default:r(()=>[s(ue,{value:u.wsUrl,"onUpdate:value":t[12]||(t[12]=d=>u.wsUrl=d)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])])}}},Qo=Tt(Po,[["__scopeId","data-v-c1d772c0"]]);export{Qo as default};
